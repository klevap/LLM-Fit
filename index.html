<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-t="page_title">LLM Fit: GPU Memory Calculator</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="main-header">
        <div class="header-title">
            <h1 data-t="main_header">ðŸ§© LLM Fit</h1>
            <p class="subtitle" data-t="subtitle">Your LLM-to-GPU Sizing Tool</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <button id="theme-toggle" class="control-btn">ðŸŽ¨</button>
            </div>
            <div class="control-group">
                <button id="lang-en" class="control-btn">EN</button>
                <button id="lang-ru" class="control-btn">RU</button>
            </div>
        </div>
    </header>

    <div class="page-grid">
      <!-- Left Column: Model Catalog & Architecture -->
      <div class="card">
        <div class="section-title" data-t="model_catalog">Model Catalog</div>
        <div class="row">
          <div class="col-12 variant-container">
            <label data-t="model_select">Model</label>
            <select id="model-select"></select>
            <button id="reset-btn" class="reset-btn" style="display:none;" data-t="reset">Reset</button>
          </div>
        </div>
        <div class="row">
            <div class="col-12 config-controls">
                <button id="download-config-btn" class="control-btn" data-t="download_config">Download Config</button>
                <input type="file" id="upload-config-input" accept=".json" style="display: none;">
                <label for="upload-config-input" class="control-btn" data-t="upload_config">Upload Config</label>
            </div>
        </div>

        <div class="section-title" style="margin-top:18px" data-t="architecture">Model Architecture</div>
        <div id="architecture-container">
            <!-- Dynamic architecture blocks will be rendered here -->
        </div>
        
        <div class="section-title" style="margin-top:18px" data-t="description_tech">Description & Technologies</div>
        <div id="modelNotes" class="muted" data-t-placeholder="model_notes_placeholder">...</div>
        <div id="modelLinks" class="help" style="margin-top:6px"></div>
      </div>

      <!-- Right Column: Modes & Calculations -->
      <div class="card">
        <div class="section-title" data-t="mode_and_params">Mode & Calculation Parameters</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn active" id="tab-train" data-tab="train" data-t="training">Training</button>
          <button class="tab-btn" id="tab-infer" data-tab="infer" data-t="inference">Inference</button>
        </div>

        <!-- TRAINING PANE -->
        <div id="pane-train">
          <div class="grid-2" style="margin-top:12px">
            <div><label data-t="precision">Precision</label><select id="precisionTrain"><option value="amp" selected data-t="precision_amp">AMP (BF16 + FP32 master)</option><option value="bf16" data-t="precision_bf16">BF16/FP16</option><option value="fp32" data-t="precision_fp32">FP32</option><option value="q4lora" data-t="precision_qlora">QLoRA (4-bit base)</option></select></div>
            <div><label data-t="optimizer">Optimizer</label><select id="optimizer"><option value="adamw" selected>AdamW</option><option value="sgdm" data-t="optimizer_sgdm">SGD w/ Momentum</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="dp_gpus">Data Parallel GPUs</label><input type="number" id="dp" value="1" /></div>
            <div><label>ZeRO Stage</label><select id="zero"><option value="0" data-t="zero_0">0 (Off)</option><option value="1" data-t="zero_1">1 (Opt.)</option><option value="2" data-t="zero_2">2 (+Grad)</option><option value="3" data-t="zero_3">3 (+Weights)</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="seq_len_s">Sequence Length S</label><input type="number" id="seqTrain" value="4096" /></div>
            <div><label data-t="batch_per_gpu_b">Batch per GPU B</label><input type="number" id="mbsz" value="2" /></div>
          </div>
          <div class="grid-2">
            <div><label>Gradient Checkpointing</label><select id="ckpt"><option value="full" selected data-t="full">Full</option><option value="none" data-t="no">No</option></select></div>
            <div><label>Flash Attention</label><select id="flash"><option value="true" selected data-t="yes">Yes</option><option value="false" data-t="no">No</option></select></div>
          </div>
        </div>

        <!-- INFERENCE PANE -->
        <div id="pane-infer" style="display:none">
          <div class="grid-2" style="margin-top:12px">
            <div><label data-t="weight_quantization">Weight Quantization</label><select id="quant"><option value="fp16">FP16</option><option value="bf16">BF16</option><option value="int8">INT8</option><option value="int4" selected>INT4</option><option value="int3">INT3</option><option value="int2">INT2</option></select></div>
            <div><label data-t="kv_cache_quantization">KV Cache Quantization</label><select id="quantKV"><option value="fp16" selected>FP16</option><option value="int8">INT8</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="context_window">Context, tokens</label><input type="number" id="seqInfer" value="8192" /></div>
            <div><label data-t="batch_size">Batch Size</label><input type="number" id="batchInfer" value="1" /></div>
          </div>
        </div>

        <div class="section-title" style="margin-top:16px" data-t="results">Results</div>
        <div class="kpi-grid">
          <div class="kpi"><div class="lbl" data-t="model_parameters">Model Parameters</div><div class="val" id="paramsTotal">0</div></div>
          <div class="kpi"><div class="lbl" data-t="memory_per_gpu">Memory per GPU</div><div class="val" id="memPerGpu">0 GB</div></div>
        </div>

        <div class="results-grid">
            <div class="grid-span-2">
                <div class="section-title" data-t="memory_breakdown">Memory Breakdown</div>
                <table><tbody id="tableBody"></tbody></table>
            </div>
            <div class="grid-span-2">
                <div id="gpu_recommendation" class="recommendation" data-t-placeholder="gpu_rec_placeholder">...</div>
            </div>
        </div>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
</body>
</html>