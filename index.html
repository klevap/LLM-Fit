<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-t="page_title">LLM Fit: GPU Memory Calculator</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="main-header">
        <div class="header-title">
            <h1 data-t="main_header">ðŸ§© LLM Fit</h1>
            <p class="subtitle" data-t="subtitle">Your LLM-to-GPU Sizing Tool</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <button id="share-btn" class="control-btn" data-t="share">ðŸ”— Share</button>
            </div>
            <div class="control-group">
                <button id="theme-toggle" class="control-btn">ðŸŽ¨</button>
            </div>
            <div class="control-group">
                <button id="lang-en" class="control-btn">EN</button>
                <button id="lang-ru" class="control-btn">RU</button>
            </div>
        </div>
    </header>

    <div class="page-grid">
      <!-- Left Column: Model Catalog & Architecture -->
      <div class="card">
        <div class="section-title" data-t="model_catalog">Model Catalog</div>
        <div id="local-file-loader" style="display:none;">
            <label for="model-file-input" data-t="load_models_manually">Load models.json manually</label>
            <input type="file" id="model-file-input" accept=".json">
        </div>
        <div class="row">
          <div class="col-6"><label data-t="family">Family</label><select id="family"></select></div>
          <div class="col-6 variant-container">
            <label data-t="variant">Variant</label>
            <select id="variant"></select>
            <button id="modify-btn" class="modify-btn" style="display:none;" data-t="reset">Reset</button>
          </div>
        </div>

        <div class="section-title" style="margin-top:18px" data-t="architecture">Core Architecture</div>
        <div class="row">
          <div class="col-3"><label data-t="layers_l">Layers L</label><input type="number" id="layers"></div>
          <div class="col-3"><label data-t="hidden_h">Hidden H</label><input type="number" id="hidden"></div>
          <div class="col-3"><label data-t="heads_a">Heads A</label><input type="number" id="heads"></div>
          <div class="col-3"><label data-t="kv_heads">KV Heads</label><input type="number" id="kvHeads"></div>
        </div>
        <div class="row">
          <div class="col-3"><label data-t="ffn_multiplier">FFN Multiplier</label><input type="number" id="ffnMult" step="0.1"></div>
          <div class="col-3"><label data-t="vocab_v">Vocabulary V</label><input type="number" id="vocab"></div>
          <div class="col-3"><label data-t="tie_embeddings">Tie Embeddings</label><select id="tieEmb"><option value="true" data-t="yes">Yes</option><option value="false" data-t="no">No</option></select></div>
          <div class="col-3"><label data-t="context_window">Context</label><input type="number" id="ctx"></div>
        </div>
        
        <!-- MoE Checkbox -->
        <div class="row moe-toggle-row">
            <div class="col-12">
                <input type="checkbox" id="isMoE" />
                <label for="isMoE" data-t="is_moe_model">Mixture-of-Experts (MoE) Model</label>
            </div>
        </div>

        <!-- MoE Details Row -->
        <div class="row" id="moe-details-row" style="display: none;">
            <div class="col-6"><label data-t="moe_total_experts">Total Experts</label><input type="number" id="moeExperts"></div>
            <div class="col-6"><label data-t="moe_active_experts">Active Experts (Top-K)</label><input type="number" id="moeActiveExperts"></div>
        </div>

        <div class="section-title" style="margin-top:18px" data-t="architecture_details">Architectural Details (Reference)</div>
        <div class="row">
            <div class="col-3"><label data-t="norm_type">Normalization</label><select id="norm"><option>RMSNorm</option><option>LayerNorm</option></select></div>
            <div class="col-3"><label data-t="activation_fn">Activation Fn</label><select id="activation"><option>SwiGLU</option><option>GeGLU</option><option>GELU</option><option>SiLU</option></select></div>
            <div class="col-3"><label data-t="mlp_structure">MLP Structure</label><select id="mlp"><option>GatedMLP</option><option>StandardMLP</option></select></div>
            <div class="col-3"><label data-t="pos_embedding">Pos. Embedding</label><select id="pos_embedding"><option>RoPE</option><option>Alibi</option><option>Learned</option></select></div>
        </div>

        <div class="section-title" style="margin-top:18px" data-t="description_tech">Description & Technologies</div>
        <div id="modelNotes" class="muted" data-t-placeholder="model_notes_placeholder">...</div>
        <div id="modelLinks" class="help" style="margin-top:6px"></div>
      </div>

      <!-- Right Column: Modes & Calculations -->
      <div class="card">
        <div class="section-title" data-t="mode_and_params">Mode & Calculation Parameters</div>
        <div class="tabs" role="tablist">
          <button class="tab-btn active" id="tab-train" data-tab="train" data-t="training">Training</button>
          <button class="tab-btn" id="tab-infer" data-tab="infer" data-t="inference">Inference</button>
        </div>

        <!-- TRAINING PANE -->
        <div id="pane-train">
          <div class="grid-2" style="margin-top:12px">
            <div><label data-t="precision">Precision</label><select id="precisionTrain"><option value="amp" selected data-t="precision_amp">AMP (BF16 + FP32 master)</option><option value="bf16" data-t="precision_bf16">BF16/FP16</option><option value="fp32" data-t="precision_fp32">FP32</option><option value="q4lora" data-t="precision_qlora">QLoRA (4-bit base)</option></select></div>
            <div><label data-t="optimizer">Optimizer</label><select id="optimizer"><option value="adamw" selected>AdamW</option><option value="sgdm" data-t="optimizer_sgdm">SGD w/ Momentum</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="dp_gpus">Data Parallel GPUs</label><input type="number" id="dp" value="1" /></div>
            <div><label>ZeRO Stage</label><select id="zero"><option value="0" data-t="zero_0">0 (Off)</option><option value="1" data-t="zero_1">1 (Opt.)</option><option value="2" data-t="zero_2">2 (+Grad)</option><option value="3" data-t="zero_3">3 (+Weights)</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="seq_len_s">Sequence Length S</label><input type="number" id="seqTrain" value="4096" /></div>
            <div><label data-t="batch_per_gpu_b">Batch per GPU B</label><input type="number" id="mbsz" value="2" /></div>
          </div>
          <div class="grid-2">
            <div><label>Gradient Checkpointing</label><select id="ckpt"><option value="full" selected data-t="full">Full</option><option value="none" data-t="no">No</option></select></div>
            <div><label>Flash Attention</label><select id="flash"><option value="true" selected data-t="yes">Yes</option><option value="false" data-t="no">No</option></select></div>
          </div>
        </div>

        <!-- INFERENCE PANE -->
        <div id="pane-infer" style="display:none">
          <div class="grid-2" style="margin-top:12px">
            <div><label data-t="weight_quantization">Weight Quantization</label><select id="quant"><option value="fp16">FP16</option><option value="bf16">BF16</option><option value="int8">INT8</option><option value="int4" selected>INT4</option><option value="int3">INT3</option><option value="int2">INT2</option></select></div>
            <div><label data-t="kv_cache_quantization">KV Cache Quantization</label><select id="quantKV"><option value="fp16" selected>FP16</option><option value="int8">INT8</option></select></div>
          </div>
          <div class="grid-2">
            <div><label data-t="context_window">Context, tokens</label><input type="number" id="seqInfer" value="8192" /></div>
            <div><label data-t="batch_size">Batch Size</label><input type="number" id="batchInfer" value="1" /></div>
          </div>
        </div>

        <div class="section-title" style="margin-top:16px" data-t="results">Results</div>
        <div class="kpi-grid">
          <div class="kpi"><div class="lbl" data-t="model_parameters">Model Parameters</div><div class="val" id="paramsTotal">0</div></div>
          <div class="kpi"><div class="lbl" data-t="memory_per_gpu">Memory per GPU</div><div class="val" id="memPerGpu">0 GB</div></div>
        </div>

        <div class="results-grid">
            <div class="grid-span-2">
                <div class="section-title" data-t="memory_breakdown">Memory Breakdown</div>
                <table><tbody id="tableBody"></tbody></table>
            </div>
            <div class="grid-span-2">
                <div id="gpu_recommendation" class="recommendation" data-t-placeholder="gpu_rec_placeholder">...</div>
            </div>
        </div>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
</body>
</html>